<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Friend Finder</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
    <form>
        <div class="card mx-auto" style="max-width: 1150px; border: none;">
            <div class="card-body">
                <h1 class="card-title">Survey Questions</h1>
                <hr>
                <h3 class="card-text" style="line-height: 2">About You</h3>
                <p>Name (Required)</p>
                <div class="input-group mb-3">
                    <input type="text" class="form-control" aria-label="name" aria-describedby="name" id="name" required>
                </div>
                <p>Link to Photo Image (Required)</p>
                <div class="input-group mb-3">
                    <input type="url" class="form-control" aria-label="link to photo" aria-describedby="photoLink" id="photoLink" required>
                </div>
                <small>Note: To find the link to a photo posted on Facebook, find the desired image in your photos, click on it, then right click the image and select "Copy image address." Paste that image address here, making sure it does NOT begin with www.facebook.com as Facebook and similar sites block cross-site domain requests.</small>
                <hr>
                <h3 class="card-text" style="line-height: 2">Question 1</h3>
                
                <p>I love animals.</p>
                <div class="input-group mb-3">
                    <select class="chosen-select questions" id="q1">
                        <option value="default">Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <h3 class="card-text" style="line-height: 2">Question 2</h3>
                <p>I like to eat healthy.</p>
                <div class="input-group mb-3">
                    <select class="chosen-select questions" id="q2">
                        <option value="default">Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <h3 class="card-text" style="line-height: 2">Question 3</h3>
                <p>I am physically active.</p>
                <div class="input-group mb-3">
                    <select class="chosen-select questions" id="q3">
                        <option value="default">Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <h3 class="card-text" style="line-height: 2">Question 4</h3>
                <p>I need to live close to my family.</p>
                <div class="input-group mb-3">
                    <select class="chosen-select questions" id="q4">
                        <option value="default">Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <h3 class="card-text" style="line-height: 2">Question 5</h3>
                <p>I like to go out clubbing.</p>
                <div class="input-group mb-3">
                    <select class="chosen-select questions" id="q5">
                        <option value="default">Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <h3 class="card-text" style="line-height: 2">Question 6</h3>
                <p>I love texting instead of face-to-face conversations.</p>
                <div class="input-group mb-3">
                    <select class="chosen-select questions" id="q6">
                        <option value="default">Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <h3 class="card-text" style="line-height: 2">Question 7</h3>
                <p>I need to talk to my BFF every day.</p>
                <div class="input-group mb-3">
                    <select class="chosen-select questions" id="q7">
                        <option value="default">Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <h3 class="card-text" style="line-height: 2">Question 8</h3>
                <p>I am a loyal friend.</p>
                <div class="input-group mb-3">
                    <select class="chosen-select questions" id="q8">
                        <option value="default">Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <h3 class="card-text" style="line-height: 2">Question 9</h3>
                <p>I love to cook.</p>
                <div class="input-group mb-3">
                    <select class="chosen-select questions" id="q9">
                        <option value="default">Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <h3 class="card-text" style="line-height: 2">Question 10</h3>
                <p>I am a sensitive person.</p>
                <div class="input-group mb-3">
                    <select class="chosen-select questions" id="q10">
                        <option value="default">Select an Option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <a id="submitSurvey" class="btn btn-primary p-3">Submit</a>
            </div>
        </div>
    </form>

    <div id='inputWarning' class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Input Warning</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>You must enter a value for each field.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div id='addModal'></div>

    <div class="card mx-auto" style="max-width: 1150px; border: none; flex-direction: row">
        <a target="_blank" href="/api/friends">API Friends List&nbsp;</a>|<a target="_blank" href="/github">&nbsp;GitHub Repo</a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    
    <!-- Handles how the form data is sent to the server -->
    <script>

    $('#inputWarning').modal('hide');

    $("#submitSurvey").on("click tap", function(event) {
        event.preventDefault();

        //Form Validation (Checks that all values have been filled out and name passes name validation):
        if ($("#name").val().trim() === "" || $("#photoLink").val().trim() === "" || $("#q1").val() === "default" || $("#q2").val() === "default" || $("#q3").val() === "default" || $("#q4").val() === "default" || $("#q5").val() === "default" || $("#q6").val() === "default" || $("#q7").val() === "default" || $("#q8").val() === "default" || $("#q9").val() === "default" || $("#q10").val() === "default") {
            //
            //
            //WORK ON SANITIZING THIS DATA!!!
            //
            //
            $('#inputWarning').modal('show');
        } else {
            //Intialize an array to hold scores temporarily
            var scoreArray = [];
            //Captures each score and pushes each one to the scoreArray in order
            var q1 = $('#q1').val();
            scoreArray.push(q1);
            var q2 = $('#q2').val();
            scoreArray.push(q2);
            var q3 = $('#q3').val();
            scoreArray.push(q3);
            var q4 = $('#q4').val();
            scoreArray.push(q4);
            var q5 = $('#q5').val();
            scoreArray.push(q5);
            var q6 = $('#q6').val();
            scoreArray.push(q6);
            var q7 = $('#q7').val();
            scoreArray.push(q7);
            var q8 = $('#q8').val();
            scoreArray.push(q8);
            var q9 = $('#q9').val();
            scoreArray.push(q9);
            var q10 = $('#q10').val();
            scoreArray.push(q10);

            // Create a new friend object and set values
            var newFriend = {
                name: $("#name").val().trim(),
                photo: $("#photoLink").val().trim(),
                scores: scoreArray
            };

            // Clear the form on submit
            $("#name").val("");
            $("#photoLink").val("");
            $(".questions").val('default');

            //Send the new friend object to the api and return a modal containing the most compatible friend
            $.post("/api/friends", newFriend, function(data) {
                //The modal to be shown is returned as data, appended to the page, and shown
                $('#addModal').append(data);
                $('#resultsModal').modal('show');
            });
        }
    });

    //Redirects to main page on close of modal
    $('#addModal').on('hidden.bs.modal', function (event) {
        console.log("Modal Closed");
        location.reload();
    });

    </script>
</body>
</html>